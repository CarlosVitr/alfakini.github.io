<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:150%/1.45 'FreightText W01 Book',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:#334259;font-family:'FreightText W01 Book',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:#121F35;font-family:'GT Walsheim Regular',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.4;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:#121F35;font-family:'GT Walsheim Regular',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.4;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:#121F35;font-family:'GT Walsheim Regular',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.4;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:#121F35;font-family:'GT Walsheim Regular',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.4;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:#121F35;font-family:'GT Walsheim Regular',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.4;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;color:#121F35;font-family:'GT Walsheim Regular',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.4;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}ul{margin-left:1.45rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.45rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.725rem;line-height:1.8em;font-size:1.015rem;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-size:0.85rem;line-height:1.45rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}blockquote{margin-left:1.45rem;margin-right:1.45rem;margin-top:0;padding-bottom:0;padding-left:0.4785rem;padding-right:0;padding-top:0;margin-bottom:1.45rem;font-style:italic;color:#454963;border-left:0.4785rem solid #134896;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.45rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.45rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.45rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}li > ul{margin-left:1.45rem;margin-bottom:calc(1.45rem / 2);margin-top:calc(1.45rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.45rem / 2);}code{font-size:0.85rem;line-height:1.45rem;}kbd{font-size:0.85rem;line-height:1.45rem;}samp{font-size:0.85rem;line-height:1.45rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.96667rem;padding-right:0.96667rem;padding-top:0.725rem;padding-bottom:calc(0.725rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}h1,h2,h3,h4,h5,h6{font-family:GT Walsheim Regular;letter-spacing:normal;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;}a{color:#134896;text-decoration:none;text-shadow:none;background-image:none;}a:hover,a:active{text-shadow:.03em 0 #fff,-.03em 0 #fff,0 .03em #fff,0 -.03em #fff,.06em 0 #fff,-.06em 0 #fff,.09em 0 #fff,-.09em 0 #fff,.12em 0 #fff,-.12em 0 #fff,.15em 0 #fff,-.15em 0 #fff;background-image:linear-gradient(to top, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0) 1px, #134896 1px, #134896 2px, rgba(0, 0, 0, 0) 2px);}a.gatsby-resp-image-link{box-shadow:none;}blockquote cite{font-size:1rem;line-height:1.45rem;color:#334259;font-style:normal;font-weight:400;}blockquote cite:before{content:"— ";}.sans{font-family:GT Walsheim Regular;}</style><style data-href="/styles.21fe9a5cefaa9af1dd03.css" id="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&display=swap);code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@font-face{font-family:GT Walsheim Regular;font-weight:400;src:url(/static/GT-Walsheim-Pro-Regular-c574ac0c42344dc5bdc0aebe018ad9fa.woff) format("woff");font-display:auto}@font-face{font-family:GT Walsheim Bold;font-weight:700;src:url(/static/GT-Walsheim-Pro-Bold-0076c7808c330a0be24a2457e857ddcc.woff) format("woff");font-display:auto}@font-face{font-family:GT Walsheim Light;font-weight:200;src:url(/static/GT-Walsheim-Pro-Light-7fb84aabb55d5f207eba7dc3546ff28e.woff) format("woff");font-display:auto}@font-face{font-family:Freight Sans W03 Light;src:url(/static/Freight-Sans-W03-Light-2bbba9fd8ca5e556987208a690c46002.woff2) format("woff2"),url(/static/Freight-Sans-W03-Light-dccc4cb8530043b55302c9ed47226564.woff) format("woff")}@font-face{font-family:Freight-Sans-W03-Book;src:url(/static/Freight-Sans-W03-Book-100da05a0201d8073337bb203e99cf3e.woff2) format("woff2"),url(/static/Freight-Sans-W03-Book-bff24b360bf341c95f053ee703176840.woff) format("woff")}@font-face{font-family:Freight Sans W03 Book Italic;src:url(/static/Freight-Sans-W03-Book-Italic-154a5ba86b75880c3e816752dcc090ee.woff2) format("woff2"),url(/static/Freight-Sans-W03-Book-Italic-fcb8e8787ccdcc4d84da95306a4299b2.woff) format("woff")}@font-face{font-family:Freight Sans W03 Bold;src:url(/static/Freight-Sans-W03-Bold-9d63c4fe01f9be84ae08f75c76de273d.woff2) format("woff2"),url(/static/Freight-Sans-W03-Bold-68ebf9176bacce66df88b9fba51d2c5b.woff) format("woff")}@font-face{font-family:FreightText W01 Book;src:url(/static/FreightText-W01-Book-dfa8496732e0d9752f7532adb68984ef.woff2) format("woff2"),url(/static/FreightText-W01-Book-62f77879b7d7426071c039d085e587b2.woff) format("woff")}@font-face{font-family:FreightText W01 Book Italic;src:url(/static/FreightText-W01-Book-Italic-a6e83944d8f7b798471dd4ecd09ca845.woff2) format("woff2"),url(/static/FreightText-W01-Book-Italic-a48d560b0ace8c872e710dae9a463505.woff) format("woff")}@font-face{font-family:FreightText W01 Bold;src:url(/static/FreightText-W01-Bold-6701778d18d8af56a6af51cbf030b137.woff2) format("woff2"),url(/static/FreightText-W01-Bold-efa6ddf035853752032b594745df5653.woff) format("woff")}@font-face{font-family:FreightText W01 Bold Italic;src:url(/static/FreightText-W01-Bold-Italic-b0f63caccd862f98159824759cd00d20.woff2) format("woff2"),url(/static/FreightText-W01-Bold-Italic-9f3803cb38e0d7913bc36c1f944acc7f.woff) format("woff")}</style><meta name="generator" content="Gatsby 2.29.3"/><title data-react-helmet="true">alfakini - Filesystem events monitoring with Python</title><meta data-react-helmet="true" name="author" content="Alan R. Fachini"/><meta data-react-helmet="true" name="description" content="Recently I had to implement a shell utility to monitor when a file is added in a directory. In this post, I will describe how we used the watchdog Python library to implement the utility and the problems I faced in the way."/><meta data-react-helmet="true" name="keywords" content="software development,software engineering,software,tecnology,blockchain,bitcoin,ethereum,rust,python,ruby,rails,data science,machine learning,management,entrepreneurship,ntrepreneur"/><meta data-react-helmet="true" property="image" content="/static/b8f3d5837f8bf3811eb2b5f2c372b3a0/3b869/share4.png"/><meta data-react-helmet="true" property="og:title" content="alfakini - Filesystem events monitoring with Python"/><meta data-react-helmet="true" property="og:site_name" content="alfakini - Filesystem events monitoring with Python"/><meta data-react-helmet="true" property="og:description" content="Recently I had to implement a shell utility to monitor when a file is added in a directory. In this post, I will describe how we used the watchdog Python library to implement the utility and the problems I faced in the way."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url" content="https://alfakini.com/essays/filesystem-events-with-python/"/><meta data-react-helmet="true" property="og:updated_time" content="1611621392292"/><meta data-react-helmet="true" property="og:image" content="/static/b8f3d5837f8bf3811eb2b5f2c372b3a0/3b869/share4.png"/><meta data-react-helmet="true" property="og:image:width" content="1200"/><meta data-react-helmet="true" property="og:image:height" content="630"/><meta data-react-helmet="true" property="og:image:alt" content="alfakini - Filesystem events monitoring with Python"/><meta data-react-helmet="true" property="fb:app_id" content="2341370742766461"/><meta data-react-helmet="true" property="fb:admins" content="100000496399542"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="alfakini"/><meta data-react-helmet="true" name="twitter:title" content="alfakini - Filesystem events monitoring with Python"/><meta data-react-helmet="true" name="twitter:description" content="Recently I had to implement a shell utility to monitor when a file is added in a directory. In this post, I will describe how we used the watchdog Python library to implement the utility and the problems I faced in the way."/><meta data-react-helmet="true" name="twitter:image" content="/static/b8f3d5837f8bf3811eb2b5f2c372b3a0/3b869/share4.png"/><meta data-react-helmet="true" name="twitter:site" content="@alfakini"/><meta data-react-helmet="true" name="twitter:url" content="https://alfakini.com/essays/filesystem-events-with-python/"/><script data-react-helmet="true" type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","url":"https://alfakini.com/essays/filesystem-events-with-python/","name":"alfakini - Filesystem events monitoring with Python","alternateName":"alfakini - Filesystem events monitoring with Python","headline":"alfakini - Filesystem events monitoring with Python","image":{"@type":"ImageObject","url":"/static/b8f3d5837f8bf3811eb2b5f2c372b3a0/3b869/share4.png"},"description":"Recently I had to implement a shell utility to monitor when a file is added in a directory. In this post, I will describe how we used the watchdog Python library to implement the utility and the problems I faced in the way.","author":{"@type":"Person","name":"Alan R. Fachini"},"publisher":{"@type":"Organization","url":"https://alfakini.com","logo":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADeElEQVQ4y51Uz28TRxSetgfiH403tnfXP4h6oST8lBCpONBGJSc4FCKUf4CqanOBRMANG5ByoahFygGLA0gml9o3BIccCgVXoATRRIqEoyQqEcUklyhRIsXe3ZmdebwZ77qptYe2I41mdmfmm+99875HIKAJr+2ce5/AOReu6wrRtuBPSTvQ34vN0QNoAbVfjr//cY4EMZIHGWMSpHWXP1ldXWXlUtmR25jc5K3554kHoA7jeis0r7k3bvxoXb50ufHX27fW8vKy9eXxr5xopFOc+HrA7Tv6hZvP5S1JVJ5rMfRu8enwBw8eOrcLd2ixeL++d+9+umtXGAZODNi9vftoPJ6ATGY3xGJdqnd2xtzZ2VnqsQSCzPjNmz85Z06fpXfv3qPnL4zSSGcXD0U1oXXpQjcykMl+JhJxA3TdhHQ6I0wzJVKptJDAoVBE/F6puBLQsixOcrmrlJCP+OlvBiGfvyb2fN4LH3/SAbqZFelMNxg4JvW0Gk0zLQzDlB2ao4EsNbdSqdD7xaIzPj5uk2/PfWc/e/qMbmxsSIHh1as/RA6Bj/YdE/GEiSC7AVmKZDKF3VQsdV2y1fFbB03TxPDwcKP0S8leW1vjBGm6K+/fs9q7Gq/X60qK+fl5uHb1utA01CudBWSGjFKQTBoIYoAEQnYiHI7A0NAQ25kFxLZtIRlubW2BbVni+fMXIpFArVLdqFMGUqYKD1maCiyR0LEnBTIEQggMDg7Sl9MvWeF2warVapRUX1cZvpJ64cXFRThypA+6NF0YqJuup5pgumImJJgcY7E4hhpn/f397NbPt+jExIQzNTXFZP6SarVKFxYWRH17m+eu5J1QKKpeD0NEFqbqMjwdgeTrYprAgQMH3bm5OctxHNbuHNJoNPj09LSzurJCUVgaDkdFGnVrsjGVdrFYDDTMuVAoLMPkkpHna2UGycz3t0ps1FGF/OjhIxqNfMolq2y2m2Pi8o6OsDh06DDr6elxT548xcrlskzilr/brUt2VhJ8XfbD98P2xYuXnFKpRJ88+Q3dUqQyYbdREt9Nvs12ergVsvzX9DiI0dFRKo0/NjZmr6+v84Cy5vs9EEwB+rSXlpbYyMiIPTk56RQKBaURii58gKD6F1RLW4AzMzP0zZ9v2ONfH1ubm5s8qKzBv2gkYLNoL7bwHxoJKvX/F0y2DxMMw1B3c3V5AAAAAElFTkSuQmCC","width":50,"height":50,"src":"/static/95a102028e3f55d2574ebb4a91198458/8ba1e/logo.png","srcSet":"/static/95a102028e3f55d2574ebb4a91198458/8ba1e/logo.png 1x,\n/static/95a102028e3f55d2574ebb4a91198458/f937a/logo.png 1.5x,\n/static/95a102028e3f55d2574ebb4a91198458/71eb7/logo.png 2x"},"name":"Alan R. Fachini"}}]</script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link href="https://github.githubassets.com/assets/gist-embed-b3b573358bfc66d89e1e95dbf8319c09.css" rel="stylesheet"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="icon" href="/favicon-32x32.png?v=95a102028e3f55d2574ebb4a91198458" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#3E2767"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=95a102028e3f55d2574ebb4a91198458"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=95a102028e3f55d2574ebb4a91198458"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=95a102028e3f55d2574ebb4a91198458"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=95a102028e3f55d2574ebb4a91198458"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=95a102028e3f55d2574ebb4a91198458"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=95a102028e3f55d2574ebb4a91198458"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=95a102028e3f55d2574ebb4a91198458"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=95a102028e3f55d2574ebb4a91198458"/><link as="script" rel="preload" href="/webpack-runtime-5c74b6c09eac3c166434.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/framework-cd3e1e804d552fa282ef.js"/><link as="script" rel="preload" href="/app-0fe2b0a74c0fe06ff414.js"/><link as="script" rel="preload" href="/c6c75317a5eb8a1474f3965d23c26c44c47412b2-30b0a902673079669494.js"/><link as="script" rel="preload" href="/component---src-templates-essay-template-js-518212fbe86614499990.js"/><link as="fetch" rel="preload" href="/page-data/essays/filesystem-events-with-python/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1573948755.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2077707862.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3569324193.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/857530042.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><header style="margin:0 auto;max-width:1200px;padding:52px 0"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin:0 10px 0 20px;vertical-align:middle"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADeElEQVQ4y51Uz28TRxSetgfiH403tnfXP4h6oST8lBCpONBGJSc4FCKUf4CqanOBRMANG5ByoahFygGLA0gml9o3BIccCgVXoATRRIqEoyQqEcUklyhRIsXe3ZmdebwZ77qptYe2I41mdmfmm+99875HIKAJr+2ce5/AOReu6wrRtuBPSTvQ34vN0QNoAbVfjr//cY4EMZIHGWMSpHWXP1ldXWXlUtmR25jc5K3554kHoA7jeis0r7k3bvxoXb50ufHX27fW8vKy9eXxr5xopFOc+HrA7Tv6hZvP5S1JVJ5rMfRu8enwBw8eOrcLd2ixeL++d+9+umtXGAZODNi9vftoPJ6ATGY3xGJdqnd2xtzZ2VnqsQSCzPjNmz85Z06fpXfv3qPnL4zSSGcXD0U1oXXpQjcykMl+JhJxA3TdhHQ6I0wzJVKptJDAoVBE/F6puBLQsixOcrmrlJCP+OlvBiGfvyb2fN4LH3/SAbqZFelMNxg4JvW0Gk0zLQzDlB2ao4EsNbdSqdD7xaIzPj5uk2/PfWc/e/qMbmxsSIHh1as/RA6Bj/YdE/GEiSC7AVmKZDKF3VQsdV2y1fFbB03TxPDwcKP0S8leW1vjBGm6K+/fs9q7Gq/X60qK+fl5uHb1utA01CudBWSGjFKQTBoIYoAEQnYiHI7A0NAQ25kFxLZtIRlubW2BbVni+fMXIpFArVLdqFMGUqYKD1maCiyR0LEnBTIEQggMDg7Sl9MvWeF2warVapRUX1cZvpJ64cXFRThypA+6NF0YqJuup5pgumImJJgcY7E4hhpn/f397NbPt+jExIQzNTXFZP6SarVKFxYWRH17m+eu5J1QKKpeD0NEFqbqMjwdgeTrYprAgQMH3bm5OctxHNbuHNJoNPj09LSzurJCUVgaDkdFGnVrsjGVdrFYDDTMuVAoLMPkkpHna2UGycz3t0ps1FGF/OjhIxqNfMolq2y2m2Pi8o6OsDh06DDr6elxT548xcrlskzilr/brUt2VhJ8XfbD98P2xYuXnFKpRJ88+Q3dUqQyYbdREt9Nvs12ergVsvzX9DiI0dFRKo0/NjZmr6+v84Cy5vs9EEwB+rSXlpbYyMiIPTk56RQKBaURii58gKD6F1RLW4AzMzP0zZ9v2ONfH1ubm5s8qKzBv2gkYLNoL7bwHxoJKvX/F0y2DxMMw1B3c3V5AAAAAElFTkSuQmCC" alt="alfakini" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/95a102028e3f55d2574ebb4a91198458/8ba1e/logo.png 1x,
/static/95a102028e3f55d2574ebb4a91198458/f937a/logo.png 1.5x,
/static/95a102028e3f55d2574ebb4a91198458/71eb7/logo.png 2x" /><img loading="lazy" width="50" height="50" srcset="/static/95a102028e3f55d2574ebb4a91198458/8ba1e/logo.png 1x,
/static/95a102028e3f55d2574ebb4a91198458/f937a/logo.png 1.5x,
/static/95a102028e3f55d2574ebb4a91198458/71eb7/logo.png 2x" src="/static/95a102028e3f55d2574ebb4a91198458/8ba1e/logo.png" alt="alfakini" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><h1 style="font-size:20px;display:inline-block;margin:0">alfakini</h1><ul style="float:right;margin-top:5px"><li style="display:inline-block"><a class="sans" style="font-size:20px;margin-right:20px" href="/essays">Essays</a></li><li style="display:inline-block"><a class="sans" style="font-size:20px;margin-right:20px" href="/library">Biblioteca</a></li></ul></header><main style="margin-left:auto;margin-right:auto;max-width:840px;padding:0 26px"><article><header><h1 style="text-align:center;margin-bottom:0">Filesystem events monitoring with Python</h1><p class="sans" style="display:block;text-align:center;font-size:20px">October 23, 2018</p></header><section><p>Recently I had to implement a shell utility to monitor when a file is added in a directory. In this post, I will describe how we used the <a href="https://pythonhosted.org/watchdog" target="_blank" rel="nofollow noopener noreferrer">watchdog Python library</a> to implement the utility and the problems I faced in the way.</p>
<!--more-->
<p>Watchdog is a library that implements a transparent API to communicate with <a href="https://pythonhosted.org/watchdog/installation.html#supported-platforms-and-caveats" target="_blank" rel="nofollow noopener noreferrer">native operational system APIs</a> and fall back to polling the disk periodically when needed. It supports APIs from BSD, Linux, macOS, and Windows.</p>
<p>In this example, I will describe the watcher class that looks for new jpg files in a network mounted directory and the event handler class to process each file. First, let’s take a look on <code class="language-text">ImageWatcher</code>:</p>
<p><div id="gist92477792" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-watcher-py" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-python  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tr>
        <td id="file-watcher-py-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-watcher-py-LC1" class="blob-code blob-code-inner js-file-line"><span class=pl-k>import</span> <span class=pl-s1>sys</span></td>
      </tr>
      <tr>
        <td id="file-watcher-py-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-watcher-py-LC2" class="blob-code blob-code-inner js-file-line"><span class=pl-k>import</span> <span class=pl-s1>time</span></td>
      </tr>
      <tr>
        <td id="file-watcher-py-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-watcher-py-LC3" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-watcher-py-LC4" class="blob-code blob-code-inner js-file-line"><span class=pl-k>from</span> <span class=pl-s1>watchdog</span>.<span class=pl-s1>observers</span> <span class=pl-k>import</span> <span class=pl-v>Observer</span></td>
      </tr>
      <tr>
        <td id="file-watcher-py-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-watcher-py-LC5" class="blob-code blob-code-inner js-file-line"><span class=pl-k>from</span> .<span class=pl-s1>events</span> <span class=pl-k>import</span> <span class=pl-v>ImagesEventHandler</span></td>
      </tr>
      <tr>
        <td id="file-watcher-py-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-watcher-py-LC6" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-watcher-py-LC7" class="blob-code blob-code-inner js-file-line"><span class=pl-k>class</span> <span class=pl-v>ImagesWatcher</span>:</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-watcher-py-LC8" class="blob-code blob-code-inner js-file-line">    <span class=pl-k>def</span> <span class=pl-en>__init__</span>(<span class=pl-s1>self</span>, <span class=pl-s1>src_path</span>):</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-watcher-py-LC9" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>self</span>.<span class=pl-s1>__src_path</span> <span class=pl-c1>=</span> <span class=pl-s1>src_path</span></td>
      </tr>
      <tr>
        <td id="file-watcher-py-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-watcher-py-LC10" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>self</span>.<span class=pl-s1>__event_handler</span> <span class=pl-c1>=</span> <span class=pl-v>ImagesEventHandler</span>()</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-watcher-py-LC11" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>self</span>.<span class=pl-s1>__event_observer</span> <span class=pl-c1>=</span> <span class=pl-v>Observer</span>()</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-watcher-py-LC12" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-watcher-py-LC13" class="blob-code blob-code-inner js-file-line">    <span class=pl-k>def</span> <span class=pl-en>run</span>(<span class=pl-s1>self</span>):</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-watcher-py-LC14" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>self</span>.<span class=pl-en>start</span>()</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-watcher-py-LC15" class="blob-code blob-code-inner js-file-line">        <span class=pl-k>try</span>:</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-watcher-py-LC16" class="blob-code blob-code-inner js-file-line">            <span class=pl-k>while</span> <span class=pl-c1>True</span>:</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-watcher-py-LC17" class="blob-code blob-code-inner js-file-line">                <span class=pl-s1>time</span>.<span class=pl-en>sleep</span>(<span class=pl-c1>1</span>)</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-watcher-py-LC18" class="blob-code blob-code-inner js-file-line">        <span class=pl-k>except</span> <span class=pl-v>KeyboardInterrupt</span>:</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-watcher-py-LC19" class="blob-code blob-code-inner js-file-line">            <span class=pl-s1>self</span>.<span class=pl-en>stop</span>()</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-watcher-py-LC20" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-watcher-py-LC21" class="blob-code blob-code-inner js-file-line">    <span class=pl-k>def</span> <span class=pl-en>start</span>(<span class=pl-s1>self</span>):</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-watcher-py-LC22" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>self</span>.<span class=pl-en>__schedule</span>()</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-watcher-py-LC23" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>self</span>.<span class=pl-s1>__event_observer</span>.<span class=pl-en>start</span>()</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-watcher-py-LC24" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-watcher-py-LC25" class="blob-code blob-code-inner js-file-line">    <span class=pl-k>def</span> <span class=pl-en>stop</span>(<span class=pl-s1>self</span>):</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-watcher-py-LC26" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>self</span>.<span class=pl-s1>__event_observer</span>.<span class=pl-en>stop</span>()</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-watcher-py-LC27" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>self</span>.<span class=pl-s1>__event_observer</span>.<span class=pl-en>join</span>()</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-watcher-py-LC28" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-watcher-py-LC29" class="blob-code blob-code-inner js-file-line">    <span class=pl-k>def</span> <span class=pl-en>__schedule</span>(<span class=pl-s1>self</span>):</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-watcher-py-LC30" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>self</span>.<span class=pl-s1>__event_observer</span>.<span class=pl-en>schedule</span>(</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-watcher-py-LC31" class="blob-code blob-code-inner js-file-line">            <span class=pl-s1>self</span>.<span class=pl-s1>__event_handler</span>,</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-watcher-py-LC32" class="blob-code blob-code-inner js-file-line">            <span class=pl-s1>self</span>.<span class=pl-s1>__src_path</span>,</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-watcher-py-LC33" class="blob-code blob-code-inner js-file-line">            <span class=pl-s1>recursive</span><span class=pl-c1>=</span><span class=pl-c1>True</span></td>
      </tr>
      <tr>
        <td id="file-watcher-py-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-watcher-py-LC34" class="blob-code blob-code-inner js-file-line">        )</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-watcher-py-LC35" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-watcher-py-LC36" class="blob-code blob-code-inner js-file-line"><span class=pl-k>if</span> <span class=pl-s1>__name__</span> <span class=pl-c1>==</span> <span class=pl-s>&quot;__main__&quot;</span>:</td>
      </tr>
      <tr>
        <td id="file-watcher-py-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-watcher-py-LC37" class="blob-code blob-code-inner js-file-line">    <span class=pl-s1>src_path</span> <span class=pl-c1>=</span> <span class=pl-s1>sys</span>.<span class=pl-s1>argv</span>[<span class=pl-c1>1</span>] <span class=pl-k>if</span> <span class=pl-en>len</span>(<span class=pl-s1>sys</span>.<span class=pl-s1>argv</span>) <span class=pl-c1>&gt;</span> <span class=pl-c1>1</span> <span class=pl-k>else</span> <span class=pl-s>&#39;.&#39;</span></td>
      </tr>
      <tr>
        <td id="file-watcher-py-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-watcher-py-LC38" class="blob-code blob-code-inner js-file-line">    <span class=pl-v>ImagesWatcher</span>(<span class=pl-s1>src_path</span>).<span class=pl-en>run</span>()</td>
      </tr>
</table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/alfakini/2068679131598835add93575c85a3657/raw/845f951d1fb89715431154a1beef357581b943da/watcher.py" style="float:right">view raw</a>
        <a href="https://gist.github.com/alfakini/2068679131598835add93575c85a3657#file-watcher-py">watcher.py</a>
        hosted with &#10084; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div></p>
<p>The <code class="language-text">ImagesWatcher</code> class implements the <code class="language-text">run</code> method that is responsible for starting and stoping the observer by pressing <code class="language-text">Control-C</code>. Pay special attention to <code class="language-text">watchdog.observers.Observer</code> and <code class="language-text">images.events.ImagesEventHandler</code>. The <code class="language-text">Observer</code> is the class that watches for any file system change and then dispatches the event to the <code class="language-text">ImagesEventHandler</code>, the custom event handler we implemented to process the images.</p>
<p>In the <code class="language-text">ImagesEventHandler</code> we extend <code class="language-text">RegexMatchingEventHandler</code> so we can take advantage of processing just events related with files with the jpg extension. By extending an event handler class provided by Watchdog we gain the ability to handle modified, created, deleted and moved <a href="https://pythonhosted.org/watchdog/api.html#event-classes" target="_blank" rel="nofollow noopener noreferrer">events</a> by implementing the following methods:</p>
<ul>
<li><strong>on<em>any</em>event(event)</strong>: catch-all <a href="https://pythonhosted.org/watchdog/api.html#watchdog.events.FileSystemEvent" target="_blank" rel="nofollow noopener noreferrer">file system events</a></li>
<li><strong>on_created(event)</strong>: called when a <a href="https://pythonhosted.org/watchdog/api.html#watchdog.events.FileCreatedEvent" target="_blank" rel="nofollow noopener noreferrer">file or directory is created</a></li>
<li><strong>on_deleted(event)</strong>: called when a <a href="https://pythonhosted.org/watchdog/api.html#watchdog.events.FileCreatedEvent" target="_blank" rel="nofollow noopener noreferrer">file or directory is deleted</a></li>
<li><strong>on_modified(event)</strong>: called when a <a href="https://pythonhosted.org/watchdog/api.html#watchdog.events.FileModifiedEvent" target="_blank" rel="nofollow noopener noreferrer">file or directory is changed</a></li>
<li><strong>on_moved(event)</strong>: called when a <a href="https://pythonhosted.org/watchdog/api.html#watchdog.events.FileSystemMovedEvent" target="_blank" rel="nofollow noopener noreferrer">file or a directory is moved or renamed</a></li>
</ul>
<p>Each of these methods receives the related event object as a parameter. All event objects have the attributes <code class="language-text">event_type</code>, <code class="language-text">is_directory</code>, and <code class="language-text">src_path</code>.</p>
<p>To open and process the images we will use <a href="https://pillow.readthedocs.io/en/stable/" target="_blank" rel="nofollow noopener noreferrer">Pillow library</a>. The following code creates the thumbnail of images preserving aspect ratios with 128x128 maximum resolution and converts colors to gray scale. Also, in our event handler, we will implement just the <code class="language-text">on_created</code> method to react just when a new file is created in the directory. All other events will still be handled as we’re extending <code class="language-text">RegexMatchingEventHandler</code>. Note we define the constant <code class="language-text">IMAGES_REGEX</code> where we indicate the file types we support:</p>
<p><div id="gist92477775" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-events-py" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-python  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tr>
        <td id="file-events-py-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-events-py-LC1" class="blob-code blob-code-inner js-file-line"><span class=pl-k>import</span> <span class=pl-s1>os</span></td>
      </tr>
      <tr>
        <td id="file-events-py-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-events-py-LC2" class="blob-code blob-code-inner js-file-line"><span class=pl-k>from</span> <span class=pl-v>PIL</span> <span class=pl-k>import</span> <span class=pl-v>Image</span></td>
      </tr>
      <tr>
        <td id="file-events-py-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-events-py-LC3" class="blob-code blob-code-inner js-file-line"><span class=pl-k>from</span> <span class=pl-v>PIL</span>.<span class=pl-v>ImageOps</span> <span class=pl-k>import</span> <span class=pl-s1>grayscale</span></td>
      </tr>
      <tr>
        <td id="file-events-py-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-events-py-LC4" class="blob-code blob-code-inner js-file-line"><span class=pl-k>from</span> <span class=pl-s1>watchdog</span>.<span class=pl-s1>events</span> <span class=pl-k>import</span> <span class=pl-v>RegexMatchingEventHandler</span></td>
      </tr>
      <tr>
        <td id="file-events-py-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-events-py-LC5" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-events-py-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-events-py-LC6" class="blob-code blob-code-inner js-file-line"><span class=pl-k>class</span> <span class=pl-v>ImagesEventHandler</span>(<span class=pl-v>RegexMatchingEventHandler</span>):</td>
      </tr>
      <tr>
        <td id="file-events-py-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-events-py-LC7" class="blob-code blob-code-inner js-file-line">    <span class=pl-v>THUMBNAIL_SIZE</span> <span class=pl-c1>=</span> (<span class=pl-c1>128</span>, <span class=pl-c1>128</span>)</td>
      </tr>
      <tr>
        <td id="file-events-py-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-events-py-LC8" class="blob-code blob-code-inner js-file-line">    <span class=pl-v>IMAGES_REGEX</span> <span class=pl-c1>=</span> [<span class=pl-s>r&quot;.*[^_thumbnail]\.jpg$&quot;</span>]</td>
      </tr>
      <tr>
        <td id="file-events-py-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-events-py-LC9" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-events-py-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-events-py-LC10" class="blob-code blob-code-inner js-file-line">    <span class=pl-k>def</span> <span class=pl-en>__init__</span>(<span class=pl-s1>self</span>):</td>
      </tr>
      <tr>
        <td id="file-events-py-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-events-py-LC11" class="blob-code blob-code-inner js-file-line">        <span class=pl-en>super</span>().<span class=pl-en>__init__</span>(<span class=pl-s1>self</span>.<span class=pl-v>IMAGES_REGEX</span>)</td>
      </tr>
      <tr>
        <td id="file-events-py-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-events-py-LC12" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-events-py-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-events-py-LC13" class="blob-code blob-code-inner js-file-line">    <span class=pl-k>def</span> <span class=pl-en>on_created</span>(<span class=pl-s1>self</span>, <span class=pl-s1>event</span>):</td>
      </tr>
      <tr>
        <td id="file-events-py-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-events-py-LC14" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>self</span>.<span class=pl-en>process</span>(<span class=pl-s1>event</span>)</td>
      </tr>
      <tr>
        <td id="file-events-py-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-events-py-LC15" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-events-py-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-events-py-LC16" class="blob-code blob-code-inner js-file-line">    <span class=pl-k>def</span> <span class=pl-en>process</span>(<span class=pl-s1>self</span>, <span class=pl-s1>event</span>):</td>
      </tr>
      <tr>
        <td id="file-events-py-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-events-py-LC17" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>filename</span>, <span class=pl-s1>ext</span> <span class=pl-c1>=</span> <span class=pl-s1>os</span>.<span class=pl-s1>path</span>.<span class=pl-en>splitext</span>(<span class=pl-s1>event</span>.<span class=pl-s1>src_path</span>)</td>
      </tr>
      <tr>
        <td id="file-events-py-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-events-py-LC18" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>filename</span> <span class=pl-c1>=</span> <span class=pl-s>f&quot;<span class=pl-s1><span class=pl-kos>{</span><span class=pl-s1>filename</span><span class=pl-kos>}</span></span>_thumbnail.jpg&quot;</span></td>
      </tr>
      <tr>
        <td id="file-events-py-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-events-py-LC19" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-events-py-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-events-py-LC20" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>image</span> <span class=pl-c1>=</span> <span class=pl-v>Image</span>.<span class=pl-en>open</span>(<span class=pl-s1>event</span>.<span class=pl-s1>src_path</span>)</td>
      </tr>
      <tr>
        <td id="file-events-py-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-events-py-LC21" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>image</span> <span class=pl-c1>=</span> <span class=pl-en>grayscale</span>(<span class=pl-s1>image</span>)</td>
      </tr>
      <tr>
        <td id="file-events-py-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-events-py-LC22" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>image</span>.<span class=pl-en>thumbnail</span>(<span class=pl-s1>self</span>.<span class=pl-v>THUMBNAIL_SIZE</span>)</td>
      </tr>
      <tr>
        <td id="file-events-py-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-events-py-LC23" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>image</span>.<span class=pl-en>save</span>(<span class=pl-s1>filename</span>)</td>
      </tr>
</table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/alfakini/7b2ae9f65ab51884e7db7906bd4eccf8/raw/d2084ab86db6a8425eb367d1a25c0236639637c1/events.py" style="float:right">view raw</a>
        <a href="https://gist.github.com/alfakini/7b2ae9f65ab51884e7db7906bd4eccf8#file-events-py">events.py</a>
        hosted with &#10084; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div></p>
<p>That’s all needed to watch new files moved to our directory. Let’s run the watcher in a shell using the following command:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">python watcher.py /mnt</code></pre></div>
<p>And open another one to move files:</p>
<p><img src="/20a4020aaa9e69167b66150a6203aa0d/terminal.gif" alt="Testing file system watcher"></p>
<p>You should see the logging messages and the files appearing in the directory.</p>
<h2>Working with files in network mounted volumes</h2>
<p>Now, let’s discuss a problem I faced when deploying it. When moving big files in a network mounted directory and the network connection isn’t good or when uploading big files, it can take time to finish moving the file. The problem is that the <code class="language-text">on_created</code> event is dispatched when the file first appears in the directory and if you try to read the file you may find that it is corrupted because it didn’t finish uploading. To solve this problem, we have to change the <code class="language-text">ImagesEventHandler</code> class and check if the file size is still increasing:</p>
<p><div id="gist92477975" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-events_two-py" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-python  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tr>
        <td id="file-events_two-py-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-events_two-py-LC1" class="blob-code blob-code-inner js-file-line"><span class=pl-k>def</span> <span class=pl-en>on_created</span>(<span class=pl-s1>self</span>, <span class=pl-s1>event</span>):</td>
      </tr>
      <tr>
        <td id="file-events_two-py-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-events_two-py-LC2" class="blob-code blob-code-inner js-file-line">    <span class=pl-s1>file_size</span> <span class=pl-c1>=</span> <span class=pl-c1>-</span><span class=pl-c1>1</span></td>
      </tr>
      <tr>
        <td id="file-events_two-py-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-events_two-py-LC3" class="blob-code blob-code-inner js-file-line">    <span class=pl-k>while</span> <span class=pl-s1>file_size</span> <span class=pl-c1>!=</span> <span class=pl-s1>os</span>.<span class=pl-s1>path</span>.<span class=pl-en>getsize</span>(<span class=pl-s1>event</span>.<span class=pl-s1>src_path</span>):</td>
      </tr>
      <tr>
        <td id="file-events_two-py-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-events_two-py-LC4" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>file_size</span> <span class=pl-c1>=</span> <span class=pl-s1>os</span>.<span class=pl-s1>path</span>.<span class=pl-en>getsize</span>(<span class=pl-s1>event</span>.<span class=pl-s1>src_path</span>)</td>
      </tr>
      <tr>
        <td id="file-events_two-py-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-events_two-py-LC5" class="blob-code blob-code-inner js-file-line">        <span class=pl-s1>time</span>.<span class=pl-en>sleep</span>(<span class=pl-c1>1</span>)</td>
      </tr>
      <tr>
        <td id="file-events_two-py-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-events_two-py-LC6" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-events_two-py-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-events_two-py-LC7" class="blob-code blob-code-inner js-file-line">    <span class=pl-s1>self</span>.<span class=pl-en>process</span>(<span class=pl-s1>event</span>)</td>
      </tr>
</table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/alfakini/c434ce1ba8a48355e8d10bc1c7490700/raw/cde0abd1ebc5a329c58cc9f187f1c8172a3d4c3a/events_two.py" style="float:right">view raw</a>
        <a href="https://gist.github.com/alfakini/c434ce1ba8a48355e8d10bc1c7490700#file-events_two-py">events_two.py</a>
        hosted with &#10084; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div></p>
<p>This way we avoid reading errors by checking if the transfer of the file is finished before processing it.</p>
<h2>Wrapping Up</h2>
<p>In this article we discussed the use of the <a href="https://pythonhosted.org/watchdog/" target="_blank" rel="nofollow noopener noreferrer">watchdog Python library</a> to implement a toy project that monitors a directory creating a gray thumbnail for each new jpg file detected.</p>
<p>There are unexpected problems that we can face like the problem I described when uploading files on a network mounted directory or big files. Unfortunately, because of limitations on the filesystem APIs, there isn’t good ways to solve them.</p>
<p>The library can also be used to implement filesystem events watchers for more complex scenarios, for example: monitor log changes, configuration files changes to update variables values in memory, notify a user when a file is created or changed.</p></section><div><hr style="margin:30px 0"/><div style="display:flex;align-items:center"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:80px;height:80px;margin:0 20px 0 0;min-width:80px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAUEAv/EABcBAQEBAQAAAAAAAAAAAAAAAAIBAAP/2gAMAwEAAhADEAAAAdGLueFcZk0odDRBv//EABsQAAICAwEAAAAAAAAAAAAAAAEDAAIRIjNB/9oACAEBAAEFAoNXxrRUeJOF2JlSRVPP/8QAFREBAQAAAAAAAAAAAAAAAAAAEAH/2gAIAQMBAT8BKf/EABURAQEAAAAAAAAAAAAAAAAAABEg/9oACAECAQE/ASP/xAAbEAABBAMAAAAAAAAAAAAAAAAAAQIQMREhQv/aAAgBAQAGPwI26Fb0UYWLEP/EABoQAQADAQEBAAAAAAAAAAAAAAEAESExEFH/2gAIAQEAAT8hCFVo3bcrwBXjJS4TKJdIgtd7MSp3fdn/2gAMAwEAAgADAAAAEDjnfP/EABgRAQADAQAAAAAAAAAAAAAAAAABESEx/9oACAEDAQE/ELprqUP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABAx/9oACAECAQE/EDBPb//EAB0QAQADAQACAwAAAAAAAAAAAAEAESExQVFhcaH/2gAIAQEAAT8Q0gjrK+hcPV8lCWbHuKqgzfmapjhQpcQuUwHh2v2Wo2NfceOh5eEW7WyXy3P/2Q==" alt="Alan R. Fachini" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/e3ba4aa2b35a76c4df65fd38dcd39343/2b9ee/profile-pic.jpg 1x,
/static/e3ba4aa2b35a76c4df65fd38dcd39343/76539/profile-pic.jpg 1.5x,
/static/e3ba4aa2b35a76c4df65fd38dcd39343/e5d64/profile-pic.jpg 2x" /><img loading="lazy" width="80" height="80" srcset="/static/e3ba4aa2b35a76c4df65fd38dcd39343/2b9ee/profile-pic.jpg 1x,
/static/e3ba4aa2b35a76c4df65fd38dcd39343/76539/profile-pic.jpg 1.5x,
/static/e3ba4aa2b35a76c4df65fd38dcd39343/e5d64/profile-pic.jpg 2x" src="/static/e3ba4aa2b35a76c4df65fd38dcd39343/2b9ee/profile-pic.jpg" alt="Alan R. Fachini" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p style="margin:0">Written by <strong>Alan R. Fachini</strong>, founder of<!-- --> <a href="https://www.magrathealabs.com">Magrathea Labs</a> and<!-- --> <a href="https://www.fablabjoinville.com.br">Fab Lab Joinville</a>.<!-- --> <a href="https://twitter.com/alfakini">Follow on Twitter</a>.</p></div></div></article></main><footer class="sans" style="text-align:center;margin:100px 0"><a href="https://alfakini.com">alfakini</a> · <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a><br/><a href="https://twitter.com/alfakini">twitter</a> · <a href="https://github.com/alfakini">github</a> · <a href="https://www.goodreads.com/user/show/10157034-alan&quot;">goodreads</a> · <a href="https://www.linkedin.com/in/alfachini">linkedin</a> · <a href="https://stackoverflow.com/users/732973/alfakini">stackoverflow</a> · <a href="https://www.discogs.com/user/alfakini">discogs</a> · <a href="https://instagram.com/alfachini">instagram</a> · <a href="https://alfakini.com/rss.xml">rss</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-9281876-3', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/essays/filesystem-events-with-python/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-25b73876df0a2c080a82.js"],"app":["/app-0fe2b0a74c0fe06ff414.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-ad6431e4664bcf916d19.js"],"component---src-pages-404-js":["/component---src-pages-404-js-6f41a5e3707fac011fb1.js"],"component---src-pages-about-js":["/component---src-pages-about-js-d286f239b2967ceb119f.js"],"component---src-pages-essays-js":["/component---src-pages-essays-js-2895e5eb7885e030964b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-ee5cb56b1e42c17d393d.js"],"component---src-pages-library-js":["/component---src-pages-library-js-31ef40df8a30c7d75f85.js"],"component---src-templates-essay-template-js":["/component---src-templates-essay-template-js-518212fbe86614499990.js"]};/*]]>*/</script><script src="/polyfill-25b73876df0a2c080a82.js" nomodule=""></script><script src="/component---src-templates-essay-template-js-518212fbe86614499990.js" async=""></script><script src="/c6c75317a5eb8a1474f3965d23c26c44c47412b2-30b0a902673079669494.js" async=""></script><script src="/app-0fe2b0a74c0fe06ff414.js" async=""></script><script src="/framework-cd3e1e804d552fa282ef.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/webpack-runtime-5c74b6c09eac3c166434.js" async=""></script></body></html>