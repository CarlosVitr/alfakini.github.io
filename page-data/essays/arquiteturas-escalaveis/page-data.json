{"componentChunkName":"component---src-templates-essay-template-js","path":"/essays/arquiteturas-escalaveis/","result":{"data":{"markdownRemark":{"id":"7d624c7b-b9db-5714-bff8-0a16be5ecab9","excerpt":"Este texto apareceu primeiro na newsletter The Magrathea Times. Nos últimos anos, dados ganharam mais relevância na tomada de decisão dentro das organizações e…","html":"<blockquote>\n<p>Este texto apareceu primeiro na newsletter <a href=\"http://bit.ly/themagtim\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">The Magrathea Times</a>.</p>\n</blockquote>\n<p>Nos últimos anos, dados ganharam mais relevância na tomada de decisão dentro das organizações e viraram um ativo indispensável para a evolução dos produtos. Fazer uso adequado dos dados disponíveis representa um diferencial de mercado.</p>\n<p>Com o aumento dessa importância, surgem novas categorias de tecnologias dentro do guarda-chuva do Big Data. Anos atrás, dadas as limitações que tínhamos, todo o processamento era realizado em lotes, geralmente na virada de noite ou nos finais de semana, fazendo com que o tempo de processamento necessário fosse de pelo menos um dia de delay. O grande representante desses tempos era o <a href=\"https://hadoop.apache.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hadoop</a>, framework inspirado no <a href=\"https://pt.wikipedia.org/wiki/MapReduce\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MapReduce</a> criado dentro do Google.</p>\n<p>Em busca de enfrentar os novos desafios, começaram a surgir tecnologias com o objetivo de fazer o processamento dos dados em quase tempo real. O <a href=\"https://spark.apache.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Spark</a> vem com uma nova abordagem, usando o que se convencionou por “mini batches”, em que era possível processar tanto em quase tempo real, como em batches, a mesma massa de dados. Essa evolução trouxe vantagens, pois agora era possível não apenas processar grandes massas de dados, mas fazer isso em questão de segundos.</p>\n<p>Além disso, a abstração <a href=\"https://spark.apache.org/docs/latest/rdd-programming-guide.html#resilient-distributed-datasets-rdds%5B\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Resilient Distributed Dataset</a> (RDD) que o Spark trouxe possibilitou escrever aplicações <a href=\"https://en.wikipedia.org/wiki/Extract,_transform,_load\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ETL</a> muito mais ricas e legíveis, indo além das limitações do modelo anterior.</p>\n<p>Neste mesmo momento as grandes empresas da web enfrentavam também um outro problema. As aplicações web estavam ficando cada vez mais complexas e crescer os times se tornou um desafio.</p>\n<p>Precisávamos de novas abstrações capazes de dar conta dessa complexidade. Olhando para o passado, percebemos que tudo na computação são ciclos que se repetem: do <a href=\"https://en.wikipedia.org/wiki/Service-oriented_architecture\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Service-Oriented Architecture</a> (SOA) foi criada a ideia de micro-serviços. A grande diferença dos micro-serviços é o uso de protocolos mais leves e novos estilos arquiteturais, como <a href=\"https://en.wikipedia.org/wiki/Representational_state_transfer\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">REST</a> e <a href=\"https://grpc.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">gRPC</a>.</p>\n<p>Com a evolução dos serviços de cloud computing, fica cada vez mais fácil escalar pequenos pedaços de computação e o <a href=\"https://aws.amazon.com/serverless/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Serverless</a> se torna mais relevante. Cada unidade de computação tem alta coesão, por estar muito especializada em um determinado problema. Torna-se fácil criar pequenos times muito focados, porém outro problema começa a doer. A quebra dos serviços em nós de processamento independentes evidencia o problema de acoplamento dos serviços.</p>\n<p>Em software, um serviço é coeso quando seus membros têm relação forte e estão intimamente ligados em um objetivo comum. Um serviço que cuida exclusivamente de emissão de notas fiscais é altamente coeso. Um serviço que faz pagamento e emissão de notas fiscais, não. <strong>Serviços coesos possuem poucas responsabilidades, fazendo com que a sua manutenção seja mais simples, evitando efeitos colaterais</strong>. Fica fácil para um time manter um serviço coeso, pois é necessário conhecer apenas aquele domínio específico.</p>\n<p>O acoplamento refere-se ao relacionamento de dependência entre serviços. Serviços desacoplados têm relacionamento fraco e não dependem um do outro. <strong>Com baixo acoplamento a aplicação fica mais flexível, reusável e organizada</strong>. É possível trocar partes sem que outras sejam tocadas. É fácil criar times focados e independentes. Quando há uma mudança em um módulo altamente acoplado, há a necessidade de mudanças em outros módulos, o que pode ser mais complicado de fazer e gera mais riscos do que um módulo com baixa coesão.</p>\n<p>Manter o balanço entre coesão e acoplamento não é uma tarefa fácil. É mais uma arte do que engenharia. <strong>Geralmente quando extraímos novos serviços de forma coesa, é comum que esses serviços fiquem fortemente acoplados, pois os dados que antes eram utilizados por um só serviço agora precisarão ser compartilhados por todos os serviços extraídos.</strong></p>\n<p>Além das questões técnicas, <strong>outras questões como recursos financeiros disponíveis e time-to-market devem ser considerados</strong>. Muitas vezes a escolha pela sobrevivência ou crescimento rápido do negócio implica em baixa coesão e alto acoplamento. Este é o cenário de quase todo novo produto.</p>\n<p>Em determinado momento na história do produto, se começa a sentir uma dor econômica influenciada por essa dinâmica. O desenvolvimento vai ficando lento e não adianta contratar mais pessoas. O time-to-market fica prejudicado. Começamos então a repensar nossa arquitetura e a extrair micro-serviços.</p>\n<p>Um dos maiores desafios das arquiteturas de micro-serviços são os dados. O código pode estar desacoplado, mas os dados ainda criam acoplamento caso não saibamos lidar com eles. Muitas empresas adotam micro-serviços que nada mais são do que bancos de dados acessíveis por uma interface HTTP ou RPC. Desse modo, a comunicação no estilo <em>request-response</em> faz com que tenhamos um monolito distribuído, e qualquer falha em um serviço é propagada em cascata, afetando a experiência dos usuários. <strong>O que parecia um baixo acoplamento, na verdade não é</strong>. O espaguete que antes vivia dentro de um mesmo serviço agora está distribuído entre vários. Os times começam a se bloquear por dependerem de alterações de interfaces e estrutura de dados uns dos outros.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9ab13fc41730fc187a9910bbf3014cda/0b79a/alto-acoplamento-micro-servicos.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7ElEQVQoz1VTi27bMAz0/3/RgAHd0qJb1qEZtm5NgsSJ47hF6sXxI7ZeFOWeJQdtCYOWqeOROtFR/94cO8fD2zn41XK5eHz0Yfa7rg+Li0XhZT2aGDBnXW89KM2yXZpiYcgCgK0B0Pfs3pIRdvuOrh6WP3eHytiDpC//Vt82WW37mvuv8/h6uT0ZVxq+jffYetEuNBhJIaSUhaJ1ftoWTaupVLQ6HONj1ShTK4N4/L+qpamlXh9LfNaGkaK1jpJ4+5Rm7PsiBJQiY4zW8AOvEJYMgl3b4kFw0IM5TXZVWUbWWoDBhAV5wxreM+gQhykpz21riAIeAJBEhBQLIdyQMKQYheJE8EorczF8BSKv6ah5pDqpW6kaoVqhvI1QIduykU2nOyW8LiNNp4BnZZlslG+ek9/r+H6Rx8+QvSiKpm7AbSVlfzfxbHFK8q7rqqoqq9KSbbMy/bMWT7XpdCTPQp0FSUNSoyvUwFHJn0G1OKhAZbYcTuQl0fosUR9EETOTlyGohWsPEwZNERtyyPh4j+RwZkTYD9U4YaDABi4qWT3M7q7vf0xmd5Pjy955ISHBfD5H54EXyA/jOQ4p0bnYf7/5fDv5tFn+0qI0ZmxqOp3meT5gUPwy4R+TMSpse+fe/hRfJ9wqPOTgd//GK4LsJpYWQFyoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"alto acoplamento em micro-serviços\"\n        title=\"alto acoplamento em micro-serviços\"\n        src=\"/static/9ab13fc41730fc187a9910bbf3014cda/fcda8/alto-acoplamento-micro-servicos.png\"\n        srcset=\"/static/9ab13fc41730fc187a9910bbf3014cda/12f09/alto-acoplamento-micro-servicos.png 148w,\n/static/9ab13fc41730fc187a9910bbf3014cda/e4a3f/alto-acoplamento-micro-servicos.png 295w,\n/static/9ab13fc41730fc187a9910bbf3014cda/fcda8/alto-acoplamento-micro-servicos.png 590w,\n/static/9ab13fc41730fc187a9910bbf3014cda/efc66/alto-acoplamento-micro-servicos.png 885w,\n/static/9ab13fc41730fc187a9910bbf3014cda/c83ae/alto-acoplamento-micro-servicos.png 1180w,\n/static/9ab13fc41730fc187a9910bbf3014cda/0b79a/alto-acoplamento-micro-servicos.png 1331w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Ao adicionar um novo serviço no produto, inicialmente pode ser necessário conectá-lo a um outro serviço. Mas à medida que a empresa cresce e seus times ficam maiores, eventualmente desejaremos conectá-lo com demais serviços para que cada time tenha acesso ao máximo de informações possível, de modo que tenham autonomia para tomar as melhores decisões para o sucesso do produto.</p>\n<p>Crescem de forma exponencial o número de integrações para alcançar esta conectividade. Se tivermos seis serviços, podemos precisar de até 36 conexões para obter a sincronicidade total dos dados.</p>\n<p>Neste modelo, os serviços geralmente acabam com dados conflitantes porque não há um log central de verdade que determina quais informações são mais atualizadas e precisas. Se temos dois serviços que não estão nas versões corretas para a sincronização, pode ocorrer de uma sobrescrever a outra com dados incorretos, e pode ser inviável desfazer essa alteração.</p>\n<p>Essa situação se torna mais crítica quando incluímos as leis de proteção de dados na equação. A falta de rastreabilidade de dados apresenta um risco significativo no processo de conformidade. Essas leis, entre outras coisas, garantem direitos aos titulares dos dados, como o “direito a ser esquecido” que permite ao titular requisitar a deleção de todos seus dados pessoais dentro de determinado prazo (geralmente 7 dias). Sem o devido controle e rastreabilidade dos dados, não há maneira simples de atender essa requisição.</p>\n<p>Muitas organizações aprenderam da maneira mais difícil a lição. <strong>Uma arquitetura baseada em micro-serviços com integrações diretas rapidamente se torna incontrolável, frágil e economicamente prejudicial</strong>. A capacidade da organização de atender às necessidades de negócios atuais e em constante mudança degrada, indo na direção oposta do que estava-se tentando promover.</p>\n<p><strong>A melhor solução para esse problema é criar redundância dos dados</strong>. Cada serviço mantém uma cópia local dos dados que precisa para realizar suas tarefas. <a href=\"https://martinfowler.com/articles/201701-event-driven.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Arquiteturas baseadas em eventos</a> são uma das abordagens para implementar essa solução. Este modelo garante que a única interface de comunicação entre os serviços seja a plataforma de dados, evitando a criação de acoplamento direto entre os mesmos.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/54ccc7b10d572243092fc0b2a53c39a9/62da8/arquitetura-baseada-em-eventos.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBElEQVQoz2VSC2/aMBDO//8z07Rp67RNG91aCBUttEA1WsZgkBBCQhyS2D6f7V3sgfY4naLz3X2X7x6B9WJItTWG1JBhbclYp9MRvPnt1JpUo+aAR6FKDvQN7H9CmR48HA6bpvEeEoWaApXAvJakRQMBeRNpek/Lu/WuUIYBjjYpPbcClbWzQ9WbLehbSbWuofe0eIj3TBnPtQXvpLn5vhptdgepmcSHOAuflxFXlYQ5a8LZ4ltecYVUrj9f3kdpcQY7Vq5lxxapN/d2r7+crvdzpJXAxxSAUkBxRHS2IoNCyglI6Uam/cuc4MF5ShrRg0nIptS2rhNCeHDrRw1ohCIuNkgaWGZFXIsaFDp+Xs/Db8s4zsSm4PCjqMdRNi8a+lXweKjfhLej5FAKwLLAI2NJtN+sWBKTFkmUR+tqv9NHpsqiEGqw3l3cDBcVtOCUq9LYPeiGC5VGOktmg97g84dJ7+s0vBp3v9xfdX5OhpglKts2Qqa0EcoXtHQTTPPqVXdwt81LqSwqmomhBZ9m7TZCt4e8rqyCQmK42r4Ob59LgdRzLjBmVdpIMFYrYTRYQ2CqwtverdXtbbWTp94JQZmUf5DYDuzPk0zjxfXlxfu3Lz6+ezkddTVKH62Ox+lkwjn/55ADz8x4enBczcf960+P933Oti0LJ0KIKIoA4JRs/TJ+AUnwIWQs7qeGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"arquitetura baseada em eventos\"\n        title=\"arquitetura baseada em eventos\"\n        src=\"/static/54ccc7b10d572243092fc0b2a53c39a9/fcda8/arquitetura-baseada-em-eventos.png\"\n        srcset=\"/static/54ccc7b10d572243092fc0b2a53c39a9/12f09/arquitetura-baseada-em-eventos.png 148w,\n/static/54ccc7b10d572243092fc0b2a53c39a9/e4a3f/arquitetura-baseada-em-eventos.png 295w,\n/static/54ccc7b10d572243092fc0b2a53c39a9/fcda8/arquitetura-baseada-em-eventos.png 590w,\n/static/54ccc7b10d572243092fc0b2a53c39a9/efc66/arquitetura-baseada-em-eventos.png 885w,\n/static/54ccc7b10d572243092fc0b2a53c39a9/c83ae/arquitetura-baseada-em-eventos.png 1180w,\n/static/54ccc7b10d572243092fc0b2a53c39a9/62da8/arquitetura-baseada-em-eventos.png 1262w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Neste modelo, as aplicações se tornam produtoras e consumidoras de eventos que são escritos ou lidos da plataforma de eventos, dado suas necessidades. A plataforma funciona como um grande <a href=\"https://en.wikipedia.org/wiki/Commit_(data_management)\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Commit Log</a> global da empresa, por onde passam todos os eventos, e cada aplicação fica responsável por consolidar os dados em bancos de dados locais ou consultar os eventos quando necessário.</p>\n<p>Não importa quantos serviços a empresa precise à medida que cresce, o tempo de integração e configuração não vai mudar muito. Para seis serviços, o número máximo de conexões necessárias para dados totalmente sincronizados é apenas seis. Além disso, há uma clareza maior no fluxo de dados do sistema, onde os eventos podem servir tanto de backup ao permitirem a reconstrução de estado dos serviços, ou como auditoria, criando um grande histórico das operações realizadas. Dessa forma, o processo de adequação às leis de proteção de dados é facilitado, podendo inclusive ser automatizado.</p>\n<p>Este modelo arquitetural ajuda as organizações a escalarem a tecnologia e seus times, porém apresenta novos desafios. O primeiro deles é <strong>sabermos exatamente quando faz sentido assumirmos o custo de mover nossa arquitetura nessa direção</strong>. O segundo é a complexidade, pois sistemas distribuídos exigem conhecimento em novos padrões arquiteturais para que a distribuição dos dados seja consistente e escalável. E por último, o custo: é necessário fazer boas escolhas de tecnologias e fornecedores para que toda essa infraestrutura seja viável para o negócio.</p>","frontmatter":{"title":"Evoluindo arquiteturas na busca de produtos escaláveis","date":"October 02, 2020","description":""}}},"pageContext":{"slug":"/arquiteturas-escalaveis/","previous":{"fields":{"authors":"Alan R. Fachini","categories":["Essays"],"cover":"essays/desenvolvendo-conhecimento/images/data-info-knowledge-wisdom-together.jpg","date":"2020-06-12T16:17:13.000Z","description":"Como desenvolver conhecimento? Enquanto algumas pessoas criaram seus próprios métodos de aprendizagem ou foram incentivadas a seguir alguns hábitos, outras simplesmente tratam o conteúdo como partes isoladas, e não conseguem organizar ele para que algo com mais valor seja extraído. Neste artigo falo um pouco sobre o que é conhecimento e como podemos desenvolver ele através de um processo estruturado.","id":"36bd7a56-2999-5602-9d9e-c9ae03dc342c","images":["essays/desenvolvendo-conhecimento/images/data-info-knowledge-wisdom-together.jpg"],"published":true,"slug":"/desenvolvendo-conhecimento/","tags":["knowledge","note taking","networked thought","organizational theory"],"title":"Desenvolvendo Conhecimento"}},"next":{"fields":{"authors":"Alan R. Fachini","categories":["Software Engineering"],"cover":"/essays/ruby-em-2020/cover.png","date":"2020-12-10T16:17:13.000Z","description":"Ruby tem um histórico interessante de inovações que foram sendo absorvidas, e também criticadas, pela nossa indústria. Neste artigo falamos sobre o estado atual da linguagem de programação por trás do Ruby on Rails e sua comunidade.","id":"21508f17-4359-59d5-b9eb-4a1f0f1684e2","images":["/essays/ruby-em-2020/cover.png"],"published":true,"slug":"/ruby-em-2020/","tags":["ruby","programming"],"title":"O Ruby em 2020"}}}},"staticQueryHashes":["1573948755","2077707862","3569324193","857530042"]}