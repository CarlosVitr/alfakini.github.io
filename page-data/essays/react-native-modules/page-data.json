{"componentChunkName":"component---src-templates-essay-template-js","path":"/essays/react-native-modules/","result":{"data":{"markdownRemark":{"id":"2ad685f1-6394-58f9-8246-6527ffadfe7a","excerpt":"Neste artigo vou mostrar como desenvolver um módulo iOS nativo para React Native. Background Todo mês, em uma sexta-feira, o time da Magrathea sai do ambiente…","html":"<p>Neste artigo vou mostrar como desenvolver um módulo iOS nativo para React Native.</p>\n<h2>Background</h2>\n<p>Todo mês, em uma sexta-feira, o time da <a href=\"https://magrathealabs.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Magrathea</a> sai do ambiente tradicional da empresa e nos dedicamos a projetos experimentais para descobrir e explorar novas tecnologias, testar metodologias, ferramentas ou até mesmo validar ideias de produtos. Nós chamamos estas sextas-feiras de Hackdays.</p>\n<p>Em um dos Hackdays um dos projetos desenvolvidos foi motivado pela experimentação da tecnologia data over sound (DoS), que permite codificar dados em séries de sons e tons audíveis ou inaudíveis quase-ultra-sônicos para formar um identificador único sonoro. Os dados são codificados em um dispositivo antes da transmissão, e decodificado em um ou mais dispositivos receptores. Qualquer dispositivo que contenha um alto-falante pode emitir esse tipo de sinal, e qualquer dispositivo com um microfone pode receber e decodificar ele.</p>\n<p>Existem diversas aplicações possíveis para esse tipo de tecnologia, como: entretenimento, TV, rádio, games, automação residencial sem o uso de wifi ou bluetooth, sistemas de autenticação para liberação de acesso, sistema de autenticação em dois fatores, pagamento, ticketing, automação industrial, transmissão de informações para um grande número de pessoas em um mesmo ambiente. Se você pensar em beacons e identificadores únicos, talvez DoS faça sentido para o problema que você está tentando resolver. As possibilidades são muitas. Existe inclusive um caso de uso muito interessado da tecnologia em uma usina nuclear. Como ondas de rádio (wifi, bluetooth) podem causar interferências nos equipamentos, a transmissão de dados por áudio o é uma solução interessante.</p>\n<p>A empresa líder de mercado nesta área é a <a href=\"https://www.chirp.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Chirp</a>. A Chirp fornece SDKs em diversas plataformas e linguagens, incluindo <a href=\"http://developers.chirp.io/v2/docs/chirp-for-android\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Android</a>,  <a href=\"http://developers.chirp.io/v2/docs/chirp-and-embedded-devices\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Arduino</a>,  <a href=\"http://developers.chirp.io/v2/docs/chirp-for-ios\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">iOS</a>, <a href=\"http://developers.chirp.io/v2/docs/chirp-for-javascript\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JavaScript</a> e <a href=\"http://developers.chirp.io/v2/docs/chirp-for-python\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Python</a>. Em toda as plataformas é possível enviar sinais codificados, porém apenas com iOS e Android é possível decodificar.  Escolhemos desenvolver um protótipo de aplicação usando o React Native. Devido a limitação da biblioteca JavaScript resolvemos criar um wrapper para React Native do SDK para o iOS. É aqui que começa de verdade o problema que vou mostrar como solucionar neste post.</p>\n<h2>React Native</h2>\n<p>O React Native é uma biblioteca de código e um ecossistema de ferramentas que permite que você crie aplicativos usando JavaScript. Ele usa o mesmo princípio de design do React, permitindo que você crie uma interface usando componentes.</p>\n<p>Com o React Native você constrói aplicativos que são indistinguíveis de um aplicativo criado usando Objective-C ou Java. O React Native usa os mesmos blocos de construção de UI fundamentais que os aplicativos nativos iOS e Android, fornecendo interfaces para as APIs nativas.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6e32f6bb6b34a2140c1f25229421d2ef/d38ac/react-native.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACQ0lEQVQoz12S7U/aUBTG+/9/2T4sW5YsM3MuU4cviQShCi3oRDagvFim0EIpQikt2BYoFHr77N5GTbYn+eX05dxznnvu5ZrN5mO73SbD4XDdarUCxmQyCTabTbDdboMwDAOmTqcTAAgcxwksy4q/MwzDCEzT9Gkuoii64GRZnjYaDdCCuLu7Q71eh67rWC6XIITgRTQP0+kUmqaBGsBsNsNoNAI1FMPyqa64MdVqtWKJhHaLUVWV0KLMNbFtm9DORJIkUq1WY0qlEqEmSKVSIYIgkGw2u2UNqAROURRzvV7BdZ3I81zM5/NXXNeN8Twvdsgc9/t90LFgsViAjgVsd5TQ9322ZZEzxmOz29Og9fWIwiJ6Wv8V9q6qXVi2HW+dLvonPit8jiI3tQxzag5gjwcRBZahYzZ5xJM1onEYP7P//nKO/8UOwnEdaEM9rLdlqP2uyP3KJswyv4t28Tgqpb+glN6FcnsCu8Xj6T6LuSLi6U8GslQEoaYGShN6uw5VU5FIneLiKodcMR++2/uIw7MjkeuUefP+OoGasB81xANUs99xS4vKVwlolSR65TNYcgblmxxqUhXC0XsUTj4gl8tA6XVBR4bzH4fht7dvcLz3VeR6Em/CKFI3l9FCEeB383DuLzHv5OBRmFPvgUfjd4FemxkK5wdIJT5jONCxXq9BbwXOUnz4aWcfR6dJkWuWr81KIYn6TSaq/UxDuj5HncbaM40ij0o+iYdWM54bO9kg2ODlTFYrH+n8bbhzzOMkdSn+BZXUyi+wIeIuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"React Native\"\n        title=\"React Native\"\n        src=\"/static/6e32f6bb6b34a2140c1f25229421d2ef/fcda8/react-native.png\"\n        srcset=\"/static/6e32f6bb6b34a2140c1f25229421d2ef/12f09/react-native.png 148w,\n/static/6e32f6bb6b34a2140c1f25229421d2ef/e4a3f/react-native.png 295w,\n/static/6e32f6bb6b34a2140c1f25229421d2ef/fcda8/react-native.png 590w,\n/static/6e32f6bb6b34a2140c1f25229421d2ef/efc66/react-native.png 885w,\n/static/6e32f6bb6b34a2140c1f25229421d2ef/c83ae/react-native.png 1180w,\n/static/6e32f6bb6b34a2140c1f25229421d2ef/d38ac/react-native.png 1744w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Para você ter uma ideia, este seria um hello world escrito em React Native:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Text<span class=\"token punctuation\">,</span> View <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>View<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Text<span class=\"token operator\">></span>Olá Mundo<span class=\"token operator\">!</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Text<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>View<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Apesar do React Native fornecer uma grande quantidade de wrappers para as APIs nativas, existem muitas APIs que ainda não podem ser acessadas, em especial as de terceiros. Mas é fácil criar nossos próprios módulos nativos. Se existe uma funcionalidade nativa que precisamos acessar mas não existe um wrapper pronto em JavaScript, podemos escrever a abstração necessária.</p>\n<h2>Desenvolvendo o mólulo</h2>\n<p>Vamos comer adicionando a funcionalidade que queremos usar do SDK Chirp na aplicação iOS. Precisamos adicionar dois arquivos de código no projeto, um header <code class=\"language-text\">.h</code> com a interface e um de implementação <code class=\"language-text\">.m</code>.</p>\n<p>Primeiro, o header <code class=\"language-text\">ChirpNative.h</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"objective-c\"><pre class=\"language-objective-c\"><code class=\"language-objective-c\">#import &lt;Foundation/Foundation.h&gt;\n#import &lt;React/RCTBridgeModule.h&gt;\n#import &lt;React/RCTEventEmitter.h&gt;\n\n@interface NativeChirp : RCTEventEmitter &lt;RCTBridgeModule&gt;\n@end</code></pre></div>\n<p>E a implementação do <code class=\"language-text\">ChirpNative.m</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"objective-c\"><pre class=\"language-objective-c\"><code class=\"language-objective-c\">#import &quot;ChirpNative.h&quot;\n#import &quot;React/RCTLog.h&quot;\n#import &lt;ChirpSDK/ChirpSDK.h&gt;\n\n#define CHIRP_APP_KEY    &lt;CHIRP_APP_KEY&gt;\n#define CHIRP_APP_SECRET &lt;CHIRP_APP_SECRET&gt;\n\n@implementation NativeChirp\n\nRCT_EXPORT_MODULE();\n\n- (NSArray&lt;NSString *&gt; *)supportedEvents\n{\n  return @[@&quot;ChirpReceived&quot;];\n}\n\nRCT_EXPORT_METHOD(configChirp) {\n  [[ChirpSDK sdk] setAppKey:CHIRP_APP_KEY andSecret:CHIRP_APP_SECRET withCompletion:^(BOOL authenticated, NSError * _Nullable error) {\n    if (!authenticated || error) {\n      RCTLogInfo(@&quot;Chirp authentication error : %@&quot;, error.description);\n    }\n  }];\n\n  [[ChirpSDK sdk] setChirpHeardBlock:^(Chirp *chirp, NSError *error)\n   {\n     if (!error &amp;&amp; chirp) {\n       [chirp fetchAssociatedDataWithCompletion:^(Chirp *chirp, NSError *error) {\n         NSDictionary *data = [chirp data];\n         NSString *text = data[@&quot;text&quot;];\n         RCTLogInfo(@&quot;Message: %@&quot;, text);\n         [self sendEventWithName:@&quot;ChirpReceived&quot; body:@{@&quot;text&quot;: text}];\n       }];\n\n     }\n     else {\n       RCTLogInfo(@&quot;Error: %@&quot;, error);\n     }\n   }];\n\n  [[ChirpSDK sdk] start];\n}\n\nRCT_EXPORT_METHOD(dispatchEvent:(NSString *)text) {\n  RCTLogInfo(@&quot;Dispatch event %@&quot;, text);\n  [self sendEventWithName:@&quot;ChirpReceived&quot; body:@{@&quot;text&quot;: text}];\n}\n@end</code></pre></div>\n<p>Como não passamos nenhum argumento para <code class=\"language-text\">RCT_EXPORT_MODULE</code>, nosso módulo nativo vai ter o nome da nossa classe <code class=\"language-text\">ChirpNative</code>. Com isso, temos o esqueleto de um módulo nativo. Recomendo que você faça tudo isso dentro do XCode para facilitar o processo de build.</p>\n<h2>Usando o módulo</h2>\n<p>Usar o módulo nativo é fácil, podemos importar ele em nosso código JavaScript da seguinte forma:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NativeModules <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-native'</span>\n\n<span class=\"token keyword\">const</span> ChirpNative <span class=\"token operator\">=</span> NativeModules<span class=\"token punctuation\">.</span>ChirpNative<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Um benefício de construir o módulo dessa forma é que, se quisermos executar códigos nativos diferentes dependendo da plataforma, podemos isolar cada código em seu próprio módulo, ao invés de espalhar verificações de plataforma por diversas partes do aplicativo.</p>\n<p>Para mais detalhes, recorra a <a href=\"http://facebook.github.io/react-native/docs/native-modules-ios.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">documentação de módulos do React Native</a>.</p>","frontmatter":{"title":"Desenvolvimento de módulo nativos para React Native","date":"September 28, 2018","description":"Desenvolvendo um módulo nativo para iteroperabilidade do React Native com o iOS."}}},"pageContext":{"slug":"/react-native-modules/","previous":{"fields":{"authors":"Alan R. Fachini","categories":["Software Engineering"],"cover":"/essays/gerenciando-projetos-python/xkcd.png","date":"2018-05-02T03:01:25.000Z","description":"Neste artigo vou apresentar o Pipenv para gerenciar ambientes de desenvolvimento Python.","id":"a52853cf-7589-57f7-81d5-30aae2187022","images":["/essays/gerenciando-projetos-python/xkcd.png"],"published":true,"slug":"/gerenciando-projetos-python/","tags":["python","programming"],"title":"Gerenciando Projetos Python"}},"next":{"fields":{"authors":"Alan R. Fachini","categories":["Software Engineering"],"cover":"/essays/filesystem-events-with-python/terminal.gif","date":"2018-10-23T16:17:13.000Z","description":"Recently I had to implement a shell utility to monitor when a file is added in a directory. In this post, I will describe how we used the watchdog Python library to implement the utility and the problems I faced in the way.","id":"4fe13340-479b-598d-9f1d-8e4357c4fbad","images":["/essays/filesystem-events-with-python/terminal.gif"],"published":true,"slug":"/filesystem-events-with-python/","tags":["python","programming"],"title":"Filesystem events monitoring with Python"}}}},"staticQueryHashes":["1573948755","2077707862","3569324193","857530042"]}